<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>پرسشنامه سبک فرزندپروری</title>
<style>
body {
    font-family: Tahoma, sans-serif;
    background-color: #d4edda; /* سبز ملایم */
    direction: rtl;
    padding: 20px;
}
.container {
    background-color: #fff;
    padding: 20px 30px;
    border-radius: 10px;
    max-width: 900px;
    margin: auto;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
}
h1 { text-align: center; color: #155724; }
.question { margin-bottom: 15px; }
label { display: block; margin-bottom: 5px; }
input[type=text], select { width: 100%; padding: 8px; margin-bottom: 10px; border-radius:5px; border:1px solid #ccc; }
button { padding: 10px 20px; font-size: 16px; cursor: pointer; background-color:#28a745; color:#fff; border:none; border-radius:5px; }
button:hover { background-color:#218838; }
.result { margin-top: 20px; padding: 15px; background-color: #c3e6cb; border-radius: 8px; }
</style>
</head>
<body>
<div class="container">
<h1>پرسشنامه سنجش سبک فرزندپروری مبتنی بر تئوری انتخاب</h1>
<p>لطفاً مشخصات خود را وارد کرده و برای هر سؤال یکی از گزینه‌ها را انتخاب نمایید.</p>

<form id="surveyForm">
<label>نام:</label>
<input type="text" name="name" required>

<label>جنسیت:</label>
<input type="radio" name="gender" value="زن" required> زن
<input type="radio" name="gender" value="مرد" required> مرد

<label>سن:</label>
<input type="text" name="age" required>

<label>تحصیلات:</label>
<input type="text" name="education" required>

<hr>

<div id="questions"></div>

<button type="submit">ارسال و مشاهده نتیجه</button>
</form>

<div class="result" id="result" style="display:none;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// ========================= سوالات =========================
const questions = [
"در صورت بروز رفتار اشتباهی از فرزندم به او اطمینان می دهم که جدای از رفتارش او برای من ارزشمند است.",
"به فرزندم در مسائل شخصی اش مثل روابط اجتماعی و تحصیلی ...اعتماد دارم.",
"وقتی فرزندم را با فرزند دیگران مقایسه می کنم و احساس می کنم به خوبی فرزندان دیگران نیست، این احساسات را به فرزندم منتقل می کنم.",
"وقتی فرزندم در کاری شکست می خورد، سعی می کنم او را آرام کنم.",
"در شرایطی که فرزندم خواسته ی مطلوبم را انجام دهد، به او بیشتر محبت یا توجه می کنم",
"هنگامی که فرزندم در مسائلی نظر متفاوتی از نظر من دارد، با کمال آرامش به نظرات او توجه می کنم.",
"به فرزندم توضیح می دهم که چرا باید از قوانین پیروی کند.",
"به فرزندم هشدار می دهم که اگر به تقاضای من عمل نکند خواسته هایش را برآورده نخواهم کرد.",
"به فرزندم می گویم که اگر خواهان رفتارهای مطلوبی از طرف من است، در عوض باید خواسته هایم را اجابت کند.",
"وقتی فرزندم با احترام با دیگران برخورد می کند او را تحسین می کنم.",
"فرزندم می تواند هنگام خرید به سلیقه خودش هر چیز را انتخاب کند.",
"وقتی فرزندم در تکالیف و کارهایش موفق می شود او را تحسین می کنم.",
"اگر رابطه فرزندم با دوستانش مورد تایید من نباشد از او ایراد می گیرم.",
"از عملکرد تحصیلی فرزندم گلایه می کنم.",
"فرزندم را تهدید می کنم که اگر خواسته ام را عملی نکند، پیامدهای بدی متوجه اوست.",
"نارضایتی از شخصیت فرزندم را برایش بازگو می کنم.",
"حتی وقتی مخالف خواسته یا کار فرزندم هستم او را تشویق می کنم تا حرفش را بزند.",
"سعی می کنم کوچکترین رفتارهای مثبت فرزندم را تحسین کنم.",
"به طور مرتب به فرزندم یادآوری می کنم که وظایف و تکالیفش را فراموش نکند.",
"یکی از برنامه های طبیعی خانه ما گفتگوهای دوستانه خانوادگی است.",
"قبل از اینکه از فرزندم بخواهم کاری انجام دهد به میل و خواسته او نیز توجه می کنم.",
"فرزندم را بابت اینکه مانند همسالانش قادر نیست از عهده وظایفش برآید سرزش می کنم.",
"حتی وقتی فرزندم صحبتهایی که می کند به نظرم ارزش چندانی ندارد با این حال به صحبتهایش توجه می کنم.",
"زمانی که فرزندم با من اختلاف نظر دارد با احترام با او برخورد می کنم.",
"به فرزندم می گویم که در مورد کارهای خوب یا بد او چگونه فکر می کنم و چه احساسی دارم.",
"اگر نحوه رفتار فرزندم خوشایندم نباشد از او انتقاد می کنم.",
"اگر وضع ظاهری و پوشش فرزندم خوشایند من نباشد، از او انتقاد می کنم.",
"وقتی به فرزندم ابراز علاقه و محبت می کنم که او مطابق میل من عمل کند.",
"اجازه می دهم تا فرزندم در قوانین و مقررات خانواده دخالت کند و نظر دهد.",
"وقتی فرزندم از دوستانش برایم تعریف می کند حتی اگر  دوستانش مورد تایید من نباشند همچنان با توجه به حرفهایش گوش می دهم.",
"فرزندم را مرتب بابت اشتباهاتش سرزنش می کنم.",
"اوقات گرم و صمیمی ای با فرزندم دارم.",
"در مشکلاتی که با فرزندم دارم، سعی می کنم برای حل مشکل در وقت مناسب با او به گفتگو بپردازم.",
"وقتی فرزندم می خواهد دوستانش را به منزل دعوت کند با او همراهی می کنم.",
"دائم به فرزندم می گویم که حرف مرا گوش نمی کند.",
"اگر نحوه صحبت کردن فرزندم را دوست نداشته باشم از او ایراد می گیرم.",
"وقتی فرزندم کار نادرست یا اشتباهی انجام دهد تا مدتی آن را به رخش می کشم.",
"به فرزندم در مورد پیامد و نتیجه کارهایش توضیح می دهم.",
"هنگام مشاجره با فرزندم، او را تهدید به محرومیت از بعضی امکاناتش می کنم.",
"برای تنبیه فرزندم اجازه نمی دهم کار مورد علاقه اش را انجام دهد یا از وسایل مورد علاقه اش استفاده کند."
];

// گزینه‌ها
const options = ["همیشه", "اغلب اوقات", "گاهی اوقات", "به ندرت", "هرگز"];
const scores = [4,3,2,1,0];

// ========================= تولید فرم سوالات =========================
const container = document.getElementById("questions");
questions.forEach((q,i)=>{
    let div = document.createElement("div");
    div.className = "question";
    let html = `<label>${i+1}. ${q}</label>`;
    options.forEach((opt,j)=>{
        html += `<input type="radio" name="q${i+1}" value="${scores[j]}" required> ${opt} `;
    });
    div.innerHTML = html;
    container.appendChild(div);
});

// ========================= ارسال فرم =========================
const form = document.getElementById("surveyForm");
form.addEventListener("submit", async function(e){
    e.preventDefault();
    const formData = new FormData(form);
    const data = {};
    formData.forEach((value,key)=>{ data[key]=value; });

    try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbwRaIL9Qy2yHrdIhzMTB0RKE3PivbUgac3ZfyUzBCTkPJT2homKJ_C-jfcSeSrNZ41Dug/exec", {
            method: "POST",
            body: JSON.stringify(data)
        });
        const resultData = await res.json();

        // محاسبه نمرات خرده مقیاس‌ها
        const constructive = {
            Supporting: [1,4,17],
            Encouraging: [10,12,18,32],
            Listening: [23,30,8],
            Accepting: [6,11,29,34],
            Trusting: [2],
            Respecting: [21,24],
            Negotiating: [7,20,25,33,38]
        };
        const destructive = {
            Criticizing: [13,26,27,36],
            Blaming: [22,31],
            Complaining: [3,14,16],
            Nagging: [19,35,37],
            Threatening: [8,15,39],
            Punishing: [40],
            Bribing: [5,9,28]
        };

        function calcScores(mapping){
            let scoresObj = {};
            let total = 0;
            for(const [k,arr] of Object.entries(mapping)){
                let sum=0;
                arr.forEach(idx=>{
                    let val = parseInt(data[`q${idx}`]);
                    sum += val;
                });
                scoresObj[k]=sum;
                total += sum;
            }
            return {scoresObj, total};
        }

        const cons = calcScores(constructive);
        const des = calcScores(destructive);

        // بیشترین نمره و درصد
        const maxCons = Math.max(...Object.values(cons.scoresObj));
        const maxDes = Math.max(...Object.values(des.scoresObj));

        let resultHtml = `<h3>نتایج شما:</h3>`;
        resultHtml += `<h4>سبک سازنده:</h4><ul>`;
        for(const [k,v] of Object.entries(cons.scoresObj)){
            let percent = ((v / cons.total) * 100).toFixed(1);
            let highlight = (v===maxCons) ? " 🔹" : "";
            resultHtml += `<li>${k}: ${v} (${percent}%)${highlight}</li>`;
        }
        resultHtml += `</ul><h4>سبک مخرب:</h4><ul>`;
        for(const [k,v] of Object.entries(des.scoresObj)){
            let percent = ((v / des.total) * 100).toFixed(1);
            let highlight = (v===maxDes) ? " 🔹" : "";
            resultHtml += `<li>${k}: ${v} (${percent}%)${highlight}</li>`;
        }
        resultHtml += `</ul>`;

        // دانلود PDF
        resultHtml += `<button id="downloadPdf">دانلود PDF نتیجه</button>`;
        document.getElementById("result").innerHTML = resultHtml;
        document.getElementById("result").style.display = "block";

        document.getElementById("downloadPdf").addEventListener("click", ()=>{
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFont("Tahoma");
            doc.setFontSize(12);
            let y = 10;
            doc.text("نتایج پرسشنامه سبک فرزندپروری", 10, y);
            y+=10;
            for(const [k,v] of Object.entries(cons.scoresObj)){
                doc.text(`${k}: ${v}`,10,y);
                y+=10;
            }
            for(const [k,v] of Object.entries(des.scoresObj)){
                doc.text(`${k}: ${v}`,10,y);
                y+=10;
            }
            doc.save("نتایج_پرسشنامه.pdf");
        });

    } catch(err){
        alert("خطا در ارسال داده‌ها: "+err);
    }
});
</script>
</div>
</body>
</html>
