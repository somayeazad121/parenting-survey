<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>پرسشنامه سبک فرزندپروری مبتنی بر تئوری انتخاب</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body { font-family: Tahoma, sans-serif; direction: rtl; padding: 20px; background: #f4f4f4; }
h1 { text-align: center; }
form { background: #fff; padding: 20px; border-radius: 10px; }
.question { margin-bottom: 15px; }
label { margin-right: 10px; }
button { margin-top: 20px; padding: 10px 15px; }
.result { background: #e0ffe0; padding: 15px; margin-top: 20px; border-radius: 10px; }
</style>
</head>
<body>

<h1>پرسشنامه سبک فرزندپروری مبتنی بر تئوری انتخاب</h1>
<form id="surveyForm">
  <p>لطفاً مشخصات را وارد کنید و برای هر سؤال یکی از گزینه‌ها را انتخاب نمایید.</p>
  <label>نام: <input type="text" id="name" required></label><br>
  <label>جنسیت: 
    <input type="radio" name="gender" value="زن" required> زن
    <input type="radio" name="gender" value="مرد"> مرد
  </label><br>
  <label>سن: <input type="number" id="age" required></label><br>
  <label>تحصیلات: <input type="text" id="edu" required></label><br><br>

  <div id="questions"></div>

  <button type="submit">ارسال و مشاهده نتیجه</button>
</form>

<div class="result" id="resultDiv" style="display:none;"></div>
<button id="downloadPdfBtn" style="display:none;">دانلود PDF نتیجه</button>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbwRaIL9Qy2yHrdIhzMTB0RKE3PivbUgac3ZfyUzBCTkPJT2homKJ_C-jfcSeSrNZ41Dug/exec";

// ۴۰ سوال
const questions = [
"در صورت بروز رفتار اشتباهی از فرزندم به او اطمینان می دهم که جدای از رفتارش او برای من ارزشمند است.",
"به فرزندم در مسائل شخصی اش مثل روابط اجتماعی و تحصیلی ...اعتماد دارم .",
"وقتی فرزندم را با فرزند دیگران مقایسه می کنم و احساس می کنم به خوبی فرزندان دیگران نیست ، این احساسات را به فرزندم منتقل می کنم .",
"وقتی فرزندم در کاری شکست می خورد ، سعی می کنم او را آرام کنم .",
"در شرایطی که فرزندم خواسته ی مطلوبم را انجام دهد ، به او بیشتر محبت یا توجه می کنم",
"هنگامی که فرزندم در مسائلی نظر متفاوتی از نظر من دارد، با کمال آرامش به نظرات او توجه می کنم .",
"به فرزندم توضیح می دهم که چرا باید از قوانین پیروی کند.",
"به فرزندم هشدار می دهم که اگر به تقاضای من عمل نکند خواسته هایش را برآورده نخواهم کرد .",
"به فرزندم می گویم که اگر خواهان رفتارهای مطلوبی از طرف من است ، در عوض باید خواسته هایم را اجابت کند.",
"وقتی فرزندم با احترام با دیگران برخورد می کند او را تحسین می کنم.",
"فرزندم می تواند هنگام خرید به سلیقه خودش هر چیز را انتخاب کند .",
"وقتی فرزندم در تکالیف و کارهایش موفق می شود او را تحسین می کنم .",
"اگر رابطه فرزندم با دوستانش مورد تایید من نباشد از او ایراد می گیرم.",
"از عملکرد تحصیلی فرزندم گلایه می کنم .",
"فرزندم را تهدید می کنم که اگر خواسته ام را عملی نکند ، پیامدهای بدی متوجه اوست.",
"نارضایتی از شخصیت فرزندم را برایش بازگو می کنم .",
"حتی وقتی مخالف خواسته یا کار فرزندم هستم او را تشویق می کنم تا حرفش را بزند.",
"سعی می کنم کوچکترین رفتارهای مثبت فرزندم را تحسین کنم .",
"به طور مرتب به فرزندم یادآوری می کنم که وظایف و تکالیفش را فراموش نکند.",
"یکی از برنامه های طبیعی خانه ما گفتگوهای دوستانه خانوادگی است.",
"قبل از اینکه از فرزندم بخواهم کاری انجام دهد به میل و خواسته او نیز توجه می کنم .",
"فرزندم را بابت اینکه مانند همسالانش قادر نیست از عهده وظایفش برآید سرزش می کنم .",
"حتی وقتی فرزندم صحبتهایی که می کند به نظرم ارزش چندانی ندارد با این حال به صحبتهایش توجه می کنم .",
"زمانی که فرزندم با من اختلاف نظر دارد با احترام با او برخورد می کنم .",
"به فرزندم می گویم که در مورد کارهای خوب یا بد او چگونه فکر می کنم و چه احساسی دارم .",
"اگر نحوه رفتار فرزندم خوشایندم نباشد از او انتقاد می کنم.",
"اگر وضع ظاهری و پوشش فرزندم خوشایند من نباشد ، از او انتقاد می کنم .",
"وقتی به فرزندم ابراز علاقه و محبت می کنم که او مطابق میل من عمل کند.",
"اجازه می دهم تا فرزندم در قوانین و مقررات خانواده دخالت کند و نظر دهد.",
"وقتی فرزندم از دوستانش برایم تعریف می کند حتی اگر دوستانش مورد تایید من نباشند همچنان با توجه به حرفهایش گوش می دهم .",
"فرزندم را مرتب بابت اشتباهاتش سرزنش می کنم .",
"اوقات گرم و صمیمی ای با فرزندم دارم.",
"در مشکلاتی که با فرزندم دارم ، سعی می کنم برای حل مشکل در وقت مناسب با او به گفتگو بپردازم .",
"وقتی فرزندم می خواهد دوستانش را به منزل دعوت کند با او همراهی می کنم.",
"دائم به فرزندم می گویم که حرف مرا گوش نمی کند.",
"اگر نحوه صحبت کردن فرزندم را دوست نداشته باشم از او ایراد می گیرم .",
"وقتی فرزندم کار نادرست یا اشتباهی انجام دهد تا مدتی آن را به رخش می کشم .",
"به فرزندم در مورد پیامد و نتیجه کارهایش توضیح می دهم .",
"هنگام مشاجره با فرزندم ، او را تهدید به محرومیت از بعضی امکاناتش می کنم .",
"برای تنبیه فرزندم اجازه نمی دهم کار مورد علاقه اش را انجام دهد یا از وسایل مورد علاقه اش استفاده کند."
];

const options = ["هرگز","به ندرت","گاهی اوقات","اغلب اوقات","همیشه"];
const optionValues = [0,1,2,3,4]; // نمره گذاری

// خرده مقیاس ها
const subscales = {
  "حمایت کردن": [0,3,16], // q1,q4,q17 (index -1)
  "دلگرمی دادن": [9,11,17,31],
  "گوش دادن": [22,29],
  "پذیرفتن": [5,10,28,33],
  "اعتماد کردن": [1],
  "احترام گذاشتن": [20,23],
  "گفتگوکردن": [6,19,24,37],
  "انتقاد کردن": [12,25,26,35],
  "سرزنش کردن": [21,30],
  "شکایت و گلایه کردن": [2,13,15],
  "غر و نق زدن": [18,34,36],
  "تهدیدکردن": [7,14,38],
  "تنبیه کردن": [39],
  "مهارکردن از راه رشوه دادن": [4,8,27]
};

function createQuestions(){
  const qDiv = document.getElementById("questions");
  questions.forEach((q,i)=>{
    const div = document.createElement("div");
    div.className="question";
    div.innerHTML=`<p>${i+1}. ${q}</p>`;
    options.forEach((opt,j)=>{
      div.innerHTML += `<label><input type="radio" name="q${i+1}" value="${optionValues[j]}" required> ${opt}</label>`;
    });
    qDiv.appendChild(div);
  });
}
createQuestions();

document.getElementById("surveyForm").addEventListener("submit", function(e){
  e.preventDefault();

  const formData = {};
  formData.name = document.getElementById("name").value;
  formData.gender = document.querySelector('input[name="gender"]:checked')?.value;
  formData.age = document.getElementById("age").value;
  formData.edu = document.getElementById("edu").value;

  for(let i=1;i<=40;i++){
    formData[`q${i}`] = parseInt(document.querySelector(`input[name="q${i}"]:checked`)?.value);
  }

  // محاسبه نمرات خرده مقیاس ها
  const results = {};
  for(const [sub, arr] of Object.entries(subscales)){
    let sum = 0;
    arr.forEach(idx=>{
      sum += formData[`q${idx+1}`] || 0;
    });
    results[sub] = sum;
  }

  // سبک سازنده و مخرب
  const constructiveSubs = ["حمایت کردن","دلگرمی دادن","گوش دادن","پذیرفتن","اعتماد کردن","احترام گذاشتن","گفتگوکردن"];
  const destructiveSubs = ["انتقاد کردن","سرزنش کردن","شکایت و گلایه کردن","غر و نق زدن","تهدیدکردن","تنبیه کردن","مهارکردن از راه رشوه دادن"];

  const constructiveScore = constructiveSubs.reduce((a,b)=>a+results[b],0);
  const destructiveScore = destructiveSubs.reduce((a,b)=>a+results[b],0);

  const constructivePercent = Math.round(constructiveScore/84*100);
  const destructivePercent = Math.round(destructiveScore/76*100);

  // نمایش نتیجه
  let resultHtml = `<h3>نتیجه شما</h3>`;
  resultHtml += `<p>سبک سازنده: ${constructiveScore} از 84 (${constructivePercent}%)</p>`;
  resultHtml += `<ul>`;
  constructiveSubs.forEach(sub=>{
    resultHtml += `<li>${sub}: ${results[sub]}</li>`;
  });
  resultHtml += `</ul>`;
  resultHtml += `<p>سبک مخرب: ${destructiveScore} از 76 (${destructivePercent}%)</p>`;
  resultHtml += `<ul>`;
  destructiveSubs.forEach(sub=>{
    resultHtml += `<li>${sub}: ${results[sub]}</li>`;
  });
  resultHtml += `</ul>`;

  document.getElementById("resultDiv").innerHTML=resultHtml;
  document.getElementById("resultDiv").style.display="block";
  document.getElementById
