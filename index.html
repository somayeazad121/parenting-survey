<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>پرسشنامه سبک فرزندپروری — گزارش رایگان فوری</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f0faf6;
    --card:#ffffff;
    --accent:#0b67b2;
    --accent2:#ff8a00;
    --success:#2e7d32;
    --danger:#d32f2f;
    --purple:#7b1fa2;
    --yellow:#f9a825;
    --muted:#666;
    font-family: Vazirmatn, Tahoma, Arial, sans-serif;
  }
  /* کلی */
  html,body{height:100%}
  body{background:var(--bg);direction:rtl;margin:0;padding:18px;color:#111; -webkit-font-smoothing:antialiased}
  .wrap{max-width:1100px;margin:12px auto;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 12px 30px rgba(0,0,0,0.06)}
  h1{text-align:center;color:var(--accent);margin:6px 0 12px}
  p.lead{color:var(--muted);text-align:center;margin-top:0}
  .flex{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  label{font-weight:600}
  input[type="text"],input[type="number"],select{padding:10px;border-radius:8px;border:1px solid #ddd;font-size:15px}
  .questions{margin-top:12px}
  .question{padding:12px;border-bottom:1px solid #f0f0f0}
  .qtext{font-weight:600;margin-bottom:6px}
  .options label{margin-left:12px;font-weight:500;display:inline-block}
  .controls{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  button{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
  button.secondary{background:#555}
  .result{margin-top:18px;padding:14px;border-radius:10px;background:linear-gradient(180deg,#fbfffc,#f0fff6);border:1px solid #e6f6ea}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px;border:1px solid #e9f7ef;text-align:center}
  th{background:#eefaf4;font-weight:700}
  .charts{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
  canvas{background:#fff;border-radius:8px;padding:8px}
  .social{margin-top:18px;text-align:center;padding:12px;border-radius:8px;background:#fff}
  .social p{margin:6px 0;color:#333;font-weight:600}
  .qrwrap{display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap}
  .recommend{background:#fff;padding:10px;border-radius:8px;border:1px solid #f0f0f0;margin-top:8px}
  .hide{display:none}
  .shareBtns{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:12px}
  .shareBtns button{padding:8px 10px;border-radius:8px;font-weight:700}
  .muted{color:var(--muted)}
  /* موبایل-friendly */
  @media(max-width:900px){
    .charts{grid-template-columns:1fr}
    input[type="text"],input[type="number"],select{font-size:16px}
    .qtext{font-size:15px}
  }

  /* محافظت ساده (بازدارنده کپی آسان) */
  /* توجه: این‌ها باعث امنیت سورس نمی‌شوند - فقط مانع ساده‌اند */
  html { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
  input, select, button, textarea, .result { -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; }

</style>
</head>

<body>
  <div class="wrap">
  <h1 style="background-color:#d3f791; padding: 10px; text-align: center; font-family: Vazirmatn, sans-serif;">
  پرسشنامه سنجش سبک فرزندپروری - رایگان
</h1>

<div style="display: flex; justify-content: space-between; background-color: #a8b9ed; color: #ffffff; font-size: 12px; padding: 5px 10px; font-family: Vazirmatn, sans-serif;">
  <span>ساخته شده توسط: سمیه آزاد</span>
  <span>مبتنی بر تئوری انتخاب</span>
</div>

   
<div class="intro" style="background:#FFE4E1 ;padding:12px;border-radius:8px;margin-bottom:12px;text-align:center"> 
  <p style="margin:4px 0;color:#4d0033"> فرزندپروری آگاهانه و حمایتگر باعث رشد شخصیت و اعتمادبه‌نفس فرزندتان می‌شود. با پاسخ به این پرسشنامه می‌توانید سبک فرزندپروری خود را شناسایی و بهبود دهید. 
  </p> 
  <p style="margin:4px 0;color:#4d0033"> مناسب والدین دارای فرزند 6 الی 18 و حتی بالاتر  </p>
  <p style="font-size:16px; color:#4d0033;">

  اگر این پرسشنامه برایتان مفید بود، با دنبال کردن من در شبکه‌های اجتماعی حمایتم کنید:
  </p>


  <div class="shareBtns" style="justify-content:center;margin-top:8px"> 
  <a href="https://instagram.com/drsomayeazad" target="_blank">اینستاگرام</a> |
  <a href="https://t.me/donyayematloob1" target="_blank">تلگرام</a> |
   <a href=" https://eitaa.com/donyayematloob" target="_blank">ایتا</a> |
    <a href="https://wa.me/989335556292" target="_blank">واتساپ</a> |
<a href="#" onclick="shareLink(event)">📤 اشتراک‌گذاری پرسشنامه</a>

<script>
function shareLink(e) {
  e.preventDefault(); // جلوگیری از باز شدن لینک خالی

  const url = "https://somayeazad121.github.io/parenting-survey/";
  const title = "پرسشنامه سبک فرزندپروری";
  const text = "بیاید این پرسشنامه رو پر کنید:";

  if (navigator.share) {
    navigator.share({
      title: title,
      text: text,
      url: url
    }).catch((error) => console.log("خطا در اشتراک‌گذاری:", error));
  } else {
    navigator.clipboard.writeText(url).then(() => {
      alert("لینک پرسشنامه کپی شد ✅");
    });
  }
}
</script>

   </div>
</div>


   <p class="lead" style="font-size: 12px; color: #555; line-height: 1.4;">
  مشخصات اختیاری است — می توانید فقط سوالات ۴۰گانه را پاسخ دهید. در پایان گزارش گرافیکی + PDF + Excel دریافت می‌کنید.
</p>

    <form id="surveyForm">


<div style="display: flex; justify-content: center; align-items: center; gap: 15px; padding: 15px; background-color:#fffabc; border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); flex-wrap: wrap; max-width: 100%;">

  <!-- نام -->
  <div style="display: flex; align-items: center; gap: 5px; min-width: 120px;">
    <label style="font-size: 13px; color: #555;">نام:</label>
    <input name="name" type="text" placeholder="اختیاری"
      style="font-size: 14px; padding: 6px 10px; border-radius: 8px; border: 1px solid #ccc; width: 120px; color: #555;">
  </div>

  <!-- جنسیت -->
  <div style="display: flex; align-items: center; gap: 5px; min-width: 90px;">
    <label style="font-size: 13px; color: #555;">جنسیت:</label>
    <select name="gender"
      style="font-size: 14px; padding: 6px 10px; border-radius: 8px; border: 1px solid #ccc; width: 90px; color: #555;">
      <option value="" style="color: #999;">اختیاری</option>
      <option>زن</option>
      <option>مرد</option>
    </select>
  </div>

  <!-- سن -->
  <div style="display: flex; align-items: center; gap: 5px; min-width: 70px;">
    <label style="font-size: 13px; color: #555;">سن:</label>
    <input name="age" type="number" min="0" placeholder="اختیاری"
      style="font-size: 14px; padding: 6px 10px; border-radius: 8px; border: 1px solid #ccc; width: 70px; color: #555;">
  </div>

  <!-- تحصیلات -->
  <div style="display: flex; align-items: center; gap: 5px; min-width: 120px;">
    <label style="font-size: 13px; color: #555;">تحصیلات:</label>
    <input name="education" type="text" placeholder="اختیاری"
      style="font-size: 14px; padding: 6px 10px; border-radius: 8px; border: 1px solid #ccc; width: 120px; color: #555;">
  </div>

</div>








      
      <hr style="margin-top:12px;border:none;border-top:1px solid #eef7f0">

      <div id="questions" class="questions"></div>


      <div class="controls">
        <button id="submitBtn" type="submit">ارسال و مشاهده نتیجه</button>
        <button id="resetBtn" type="button" class="secondary">پاک‌سازی فرم</button>
        <div id="status" style="color:var(--danger);font-weight:600"></div>
      </div>


<div class="invite-links" style="text-align:center; margin: 20px 0;">
  <p> برای اطلاعات بیشتر، شبکه‌های ما را دنبال کنید:</p>

  <a href="https://instagram.com/drsomayeazad" target="_blank">اینستاگرام</a> |
  <a href="https://t.me/donyayematloob1" target="_blank">تلگرام</a> |
  <a href="https://eitaa.com/donyayematloob" target="_blank">ایتا</a> |
  <a href="https://wa.me/989335556292" target="_blank">واتساپ</a> |
  <a href="#" onclick="shareLink(event)">📤 اشتراک‌گذاری پرسشنامه</a>

 
<!-- QR Code -->
<div class="invite-links" style="text-align:center; margin: 20px 0;">
  ...
  <div id="qrcode" style="display:inline-block; margin: 20px auto;"></div>
  ...
</div>



  <!-- ایمیل -->

<div class="email" style="margin-top:15px;">
  ارسال پیام: 
<a href="https://mail.google.com/mail/?view=cm&fs=1&to=drsomayeazad@gmail.com&su=درخواست%20اطلاعات&body=سلام%20دکتر%20عزیز،%20میخواستم%20در%20مورد%20..."
     target="_blank">
       drsomayeazad@gmail.com 📧
  </a>
</div>

 
<!-- کتابخانه qrcode.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
  // لینک لینکدونی‌تان را اینجا بگذارید
  var link = "https://somayeazad121.github.io/links/"; 

  new QRCode(document.getElementById("qrcode"), {
    text: link,
    width: 160,
    height: 160,
    colorDark: "#800080",   // رنگ بنفش
    colorLight: "#ffffff"   // پس‌زمینه سفید
  });

  // نمونه تابع اشتراک‌گذاری پرسشنامه
  function shareLink(event) {
    event.preventDefault();
    if (navigator.share) {
      navigator.share({
        title: 'پرسشنامه',
        text: 'لینک پرسشنامه من:',
        url: link
      });
    } else {
      alert("مرورگر شما از اشتراک‌گذاری مستقیم پشتیبانی نمی‌کند. لینک: " + link);
    }
  }
</script>




    </form>

    <div id="resultArea" class="result hide">
      <h2 style="color:var(--accent)">نتایج شما</h2>
      <div id="meta" style="color:var(--muted)"></div>

      <h3 style="margin-top:12px">خرده‌مقیاس‌ها (سبک سازنده)</h3>
      <div id="constructiveTable"></div>

      <h3 style="margin-top:12px">خرده‌مقیاس‌ها (سبک مخرب)</h3>
      <div id="destructiveTable"></div>

      <div class="charts" style="margin-top:12px">
        <div>
          <h4 style="color:var(--accent)">نمودار سبک سازنده</h4>
          <canvas id="chartConstructive"></canvas>
        </div>
        <div>
          <h4 style="color:var(--accent2)">نمودار سبک مخرب</h4>
          <canvas id="chartDestructive"></canvas>
        </div>
      </div>

      <h3 style="margin-top:14px">خلاصه کلی</h3>
      <div id="summaryTable"></div>
      <div class="charts" style="margin-top:8px">
        <div>
          <h4 style="color:var(--purple)">مقایسه سبک‌ها (سازنده vs مخرب)</h4>
          <canvas id="chartOverall"></canvas>
        </div>
        <div>
          <h4 style="color:var(--yellow)">نمره کلی</h4>
          <canvas id="chartTotal"></canvas>
        </div>
      </div>

      <h3 style="margin-top:12px">توصیه‌های کوتاه هر خرده‌مقیاس</h3>
      <div id="recommendations"></div>

      <div style="margin-top:14px">
        <button id="downloadPdfBtn">دانلود PDF گزارش</button>
        <button id="downloadXlsBtn">دانلود اکسل (XLSX)</button>
      </div>

      <div class="social" style="margin-top:18px">
        <p>👏 تبریک! شما یک گام مهم برای شناخت و رشد شخصی برداشتید.<br>
        💡 برای یادگیری، رشد و تجربه کردن با من همراه شوید:</p>
        <p>همه لینکهای من <a href="https://somayeazad121.github.io/links/" target="_blank"> همه لینکهای من</a></p>
      
      </div>

      <div style="margin-top:18px;font-size:13px;color:#444;text-align:center">
        منبع اعتبارسنجی پرسشنامه: آزاد سمیه، اخوان تفتی مهناز، محسن پور مریم. ساخت و روایی آزمایی پرسشنامه سبکهای فرزندپروری آموزشی بر پایه تئوری انتخاب گلاسر . فصلنامه علمی- پژوهشی خانواده و پژوهش. ۱۳۹۹; ۱۷ (۲) :۱۱۹-۱۴۶<br>
        URL: <a href="http://qjfr.ir/article-۱-۱۵۰۳-fa.html" target="_blank">http://qjfr.ir/article-۱-۱۵۰۳-fa.html</a>
      </div>
    </div>
  </div>

<!-- کتابخانه‌ها -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
// ================== داده‌ها و تنظیمات ==================
const questions = [
"در صورت بروز رفتار اشتباهی از فرزندم به او اطمینان می دهم که جدای از رفتارش او برای من ارزشمند است.",
"به فرزندم در مسائل شخصی اش مثل روابط اجتماعی و تحصیلی ...اعتماد دارم.",
"وقتی فرزندم را با فرزند دیگران مقایسه می کنم و احساس می کنم به خوبی فرزندان دیگران نیست ، این احساسات را به فرزندم منتقل می کنم .",
"وقتی فرزندم در کاری شکست می خورد ، سعی می کنم او را آرام کنم .",
"در شرایطی که فرزندم خواسته ی مطلوبم را انجام دهد ، به او بیشتر محبت یا توجه می کنم",
"هنگامی که فرزندم در مسائلی نظر متفاوتی از نظر من دارد، با کمال آرامش به نظرات او توجه می کنم .",
"به فرزندم توضیح می دهم که چرا باید از قوانین پیروی کند.",
"به فرزندم هشدار می دهم که اگر به تقاضای من عمل نکند خواسته هایش را برآورده نخواهم کرد .",
"به فرزندم می گویم که اگر خواهان رفتارهای مطلوبی از طرف من است ، در عوض باید خواسته هایم را اجابت کند.",
"وقتی فرزندم با احترام با دیگران برخورد می کند او را تحسین می کنم.",
"فرزندم می تواند هنگام خرید به سلیقه خودش هر چیز را انتخاب کند .",
"وقتی فرزندم در تکالیف و کارهایش موفق می شود او را تحسین می کنم .",
"اگر رابطه فرزندم با دوستانش مورد تایید من نباشد از او ایراد می گیرم.",
"از عملکرد تحصیلی فرزندم گلایه می کنم .",
"فرزندم را تهدید می کنم که اگر خواسته ام را عملی نکند ، پیامدهای بدی متوجه اوست.",
"نارضایتی از شخصیت فرزندم را برایش بازگو می کنم .",
"حتی وقتی مخالف خواسته یا کار فرزندم هستم او را تشویق می کنم تا حرفش را بزند.",
"سعی می کنم کوچکترین رفتارهای مثبت فرزندم را تحسین کنم .",
"به طور مرتب به فرزندم یادآوری می کنم که وظایف و تکالیفش را فراموش نکند.",
"یکی از برنامه های طبیعی خانه ما گفتگوهای دوستانه خانوادگی است.",
"قبل از اینکه از فرزندم بخواهم کاری انجام دهد به میل و خواسته او نیز توجه می کنم .",
"فرزندم را بابت اینکه مانند همسالانش قادر نیست از عهده وظایفش برآید سرزش می کنم .",
"حتی وقتی فرزندم صحبتهایی که می کند به نظرم ارزش چندانی ندارد با این حال به صحبتهایش توجه می کنم .",
"زمانی که فرزندم با من اختلاف نظر دارد با احترام با او برخورد می کنم .",
"به فرزندم می گویم که در مورد کارهای خوب یا بد او چگونه فکر می کنم و چه احساسی دارم .",
"اگر نحوه رفتار فرزندم خوشایندم نباشد از او انتقاد می کنم.",
"اگر وضع ظاهری و پوشش فرزندم خوشایند من نباشد ، از او انتقاد می کنم .",
"وقتی به فرزندم ابراز علاقه و محبت می کنم که او مطابق میل من عمل کند.",
"اجازه می دهم تا فرزندم در قوانین و مقررات خانواده دخالت کند و نظر دهد.",
"وقتی فرزندم از دوستانش برایم تعریف می کند حتی اگر دوستاش مورد تایید من نباشند همچنان با توجه به حرفهایش گوش می دهم .",
"فرزندم را مرتب بابت اشتباهاتش سرزنش می کنم .",
"اوقات گرم و صمیمی ای با فرزندم دارم.",
"در مشکلاتی که با فرزندم دارم ، سعی می کنم برای حل مشکل در وقت مناسب با او به گفتگو بپردازم .",
"وقتی فرزندم می خواهد دوستانش را به منزل دعوت کند با او همراهی می کنم.",
"دائم به فرزندم می گویم که حرف مرا گوش نمی کند.",
"اگر نحوه صحبت کردن فرزندم را دوست نداشته باشم از او ایراد می گیرم .",
"وقتی فرزندم کار نادرست یا اشتباهی انجام دهد تا مدتی آن را به رخش می کشم .",
"به فرزندم در مورد پیامد و نتیجه کارهایش توضیح می دهم .",
"هنگام مشاجره با فرزندم ، او را تهدید به محرومیت از بعضی امکاناتش می کنم .",
"برای تنبیه فرزندم اجازه نمی دهم کار مورد علاقه اش را انجام دهد یا از وسایل مورد علاقه اش استفاده کند."
];

const optionLabels = ["همیشه","اغلب اوقات","گاهی اوقات","به ندرت","هرگز"];
const optionValues = [4,3,2,1,0];

// نمایش سوالات
const qContainer = document.getElementById('questions');
questions.forEach((text,i)=>{
  const div=document.createElement('div');
  div.className='question';
  let html=`<div class="qtext">سوال ${i+1}</div><div style="font-weight:500;margin-bottom:8px">${text}</div><div class="options">`;
  optionLabels.forEach((lab,j)=>{
    // required on first radio group will be validated via JS submit check
    html += `<label><input type="radio" name="q${i+1}" value="${optionValues[j]}"> ${lab}</label>`;
  });
  html += `</div>`;
  div.innerHTML=html;
  qContainer.appendChild(div);
});

// زیرمقیاس‌ها
const constructive = {
  "حمایت کردن":[1,4,17],
  "دلگرمی دادن":[10,12,18,32],
  "گوش دادن":[23,30],
  "پذیرفتن":[6,11,29,34],
  "اعتماد کردن":[2],
  "احترام گذاشتن":[21,24],
  "گفتگوکردن":[7,20,25,33,38]
};
const destructive = {
  "انتقاد کردن":[13,26,27,36],
  "سرزنش کردن":[22,31],
  "شکایت و گلایه کردن":[3,14,16],
  "غر و نق زدن":[19,35,37],
  "تهدیدکردن":[8,15,39],
  "تنبیه کردن":[40],
  "مهار از طریق رشوه (باج دادن)":[5,9,28]
};

const recommendationsText = {
  "حمایت کردن":"به فرزندتان نشان دهید که او را دوست دارید و ارزشمند می‌دانید، حتی وقتی اشتباه می‌کند؛ محبت بی‌قید و شرط موثر است.",
  "دلگرمی دادن":"موارد موفقیت‌های کوچک را بزرگ کنید، برای رفتارهای مثبت تحسین و بازخورد فوری بدهید.",
  "گوش دادن":"هنگام صحبت فرزند، قطع نکنید، گوش بدهید و احساساتش را بازتاب دهید تا اعتماد ساخته شود.",
  "پذیرفتن":"اختلاف نظر را طبیعی بدانید و سعی کنید رفتار و شخصیت او را بپذیرید، محدودیت‌گذاری همراه با توضیح مفید است.",
  "اعتماد کردن":"به او فرصت مسئولیت دادن و اعتماد نشان دهید؛ این باعث خودباوری و رشد می‌شود.",
  "احترام گذاشتن":"با احترام به نظرات او پاسخ دهید و از سرزنش عمومی خودداری کنید.",
  "گفتگوکردن":"قوانین را با گفتگوی دوطرفه توضیح دهید و در تصمیم‌گیری‌های متناسب مشارکت دهید.",
  "انتقاد کردن":"از انتقاد شخصی خودداری کنید، به‌جای آن روی رفتار مشخص و قابل تغییر تمرکز کنید.",
  "سرزنش کردن":"به‌جای سرزنش، روی راه‌حل و آموزش تمرکز کنید؛ سرزنش انگیزه را کاهش می‌دهد.",
  "شکایت و گلایه کردن":"از بیان مداوم گلایه‌ها خودداری کنید و موارد مثبت را برجسته کنید.",
  "غر و نق زدن":"برای یادآوری‌ها از روش‌های مثبت و سیستم‌های تشویقی استفاده کنید تا پرخاش کاهش یابد.",
  "تهدیدکردن":"تهدید دائمی باعث ترس و مقاومت می‌شود؛ بهتر است مرزها را واضح و سازنده تعیین کنید.",
  "تنبیه کردن":"تنبیه به‌تنهایی اثربخش نیست؛ پیامدهای منطقی و همراه با آموزش مفیدترند.",
  "مهار از طریق رشوه (باج دادن)":"از دادن پاداش‌های موقتی برای کنترل رفتار جلوگیری کنید؛ انگیزه‌های درونی را تقویت کنید."
};

// رنگ‌ها
const paletteConstructive = ['#0b67b2','#ff8a00','#7b1fa2','#2e7d32','#1e88e5','#ffb74d','#9c27b0'];
const paletteDestructive = ['#d32f2f','#f57c00','#6a1b9a','#c62828','#fb8c00','#ab47bc','#e65100'];

// توابع
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function sumArray(arr){ return arr.reduce((a,b)=>a+b,0); }

function computeSubscaleScores(data){
  const consScores = {};
  for(const [name, arr] of Object.entries(constructive)){
    let s=0; arr.forEach(q=>{ s += parseInt(data['q'+q] || 0); });
    consScores[name] = {sum:s, max: arr.length*4, pct: arr.length? Math.round((s/(arr.length*4))*100) : 0};
  }
  const desScores = {};
  for(const [name, arr] of Object.entries(destructive)){
    let s=0; arr.forEach(q=>{ s += parseInt(data['q'+q] || 0); });
    desScores[name] = {sum:s, max: arr.length*4, pct: arr.length? Math.round((s/(arr.length*4))*100) : 0};
  }
  const consTotal = sumArray(Object.values(consScores).map(o=>o.sum));
  const consMax = sumArray(Object.values(consScores).map(o=>o.max));
  const desTotal = sumArray(Object.values(desScores).map(o=>o.sum));
  const desMax = sumArray(Object.values(desScores).map(o=>o.max));
  return {consScores, desScores, consTotal, consMax, desTotal, desMax};
}

function renderSubscaleTable(containerId, scores){
  let html = `<table><thead><tr><th>بعد</th><th>نمره شما</th><th>بیشترین نمره</th><th>درصد</th></tr></thead><tbody>`;
  for(const [k,v] of Object.entries(scores)){
    html += `<tr><td style="text-align:left">${escapeHtml(k)}</td><td>${v.sum}</td><td>${v.max}</td><td>${v.pct}%</td></tr>`;
  }
  html += `</tbody></table>`;
  document.getElementById(containerId).innerHTML = html;
}

function renderRecommendations(scores){
  const wrap = document.getElementById('recommendations');
  wrap.innerHTML = '';
  for(const [k,v] of Object.entries(scores)){
    const div = document.createElement('div');
    div.className = 'recommend';
    div.innerHTML = `<strong>${escapeHtml(k)} — نمره: ${v.sum}/${v.max} (${v.pct}%)</strong>
      <p style="margin:6px 0">${escapeHtml(recommendationsText[k] || "توصیه‌ای موجود نیست.")}</p>`;
    wrap.appendChild(div);
  }
}

// نمودارها
let chartCons=null, chartDes=null, chartOverall=null, chartTotal=null;
function drawBarChart(ctxId, labels, data, colors){
  const ctx = document.getElementById(ctxId).getContext('2d');
  return new Chart(ctx, {
    type:'bar',
    data:{ labels, datasets:[{ data, backgroundColor: colors }] },
    options:{ responsive:true, scales:{ y:{ beginAtZero:true } }, plugins:{ legend:{ display:false } } }
  });
}

// پردازش فرم
document.getElementById('surveyForm').addEventListener('submit', function(e){
  e.preventDefault();
  document.getElementById('status').textContent='';

  // اعتبارسنجی: همه سوالات باید انتخاب شده باشند
  for(let i=1;i<=40;i++){
    if(!document.querySelector(`input[name="q${i}"]:checked`)){
      document.getElementById('status').textContent = `لطفاً همه سؤالات را پاسخ دهید. سوال ${i} پاسخ داده نشده.`;
      window.scrollTo({top:0,behavior:'smooth'});
      return;
    }
  }

  // جمع‌آوری داده‌ها
  const fd = new FormData(this);
  const data = {};
  fd.forEach((v,k)=> data[k]=v);

  // محاسبات
  const {consScores, desScores, consTotal, consMax, desTotal, desMax} = computeSubscaleScores(data);

  // نمایش مشخصات
  const meta = document.getElementById('meta');
  const name = data.name || '—';
  const gender = data.gender || '—';
  const age = data.age || '—';
  const education = data.education || '—';
  meta.innerHTML = `<strong>مشخصات:</strong> نام: ${escapeHtml(name)} — جنسیت: ${escapeHtml(gender)} — سن: ${escapeHtml(age)} — تحصیلات: ${escapeHtml(education)}`;

  // جدول‌ها و توصیه‌ها
  renderSubscaleTable('constructiveTable', consScores);
  renderSubscaleTable('destructiveTable', desScores);
  renderRecommendations({...consScores, ...desScores});

  // نمودار سازنده
  if(chartCons) chartCons.destroy();
  const consLabels = Object.keys(consScores);
  const consData = Object.values(consScores).map(o=>o.sum);
  chartCons = drawBarChart('chartConstructive', consLabels, consData, paletteConstructive.slice(0,consLabels.length));

  // نمودار مخرب
  if(chartDes) chartDes.destroy();
  const desLabels = Object.keys(desScores);
  const desData = Object.values(desScores).map(o=>o.sum);
  chartDes = drawBarChart('chartDestructive', desLabels, desData, paletteDestructive.slice(0,desLabels.length));

  // نمودار کلی مقایسه
  if(chartOverall) chartOverall.destroy();
  chartOverall = new Chart(document.getElementById('chartOverall').getContext('2d'), {
    type:'bar',
    data:{ labels:['سبک سازنده','سبک مخرب'], datasets:[{ data:[consTotal, desTotal], backgroundColor:['rgba(11,103,178,0.9)','rgba(211,47,47,0.9)'] }] },
    options:{ responsive:true, scales:{ y:{ beginAtZero:true } }, plugins:{ legend:{display:false} } }
  });

  // نمودار درصدی
  if(chartTotal) chartTotal.destroy();
  const pctCons = Math.round((consTotal/consMax)*100);
  const pctDes = Math.round((desTotal/desMax)*100);
  chartTotal = new Chart(document.getElementById('chartTotal').getContext('2d'), {
    type:'doughnut',
    data:{ labels:['سازنده','مخرب'], datasets:[{ data:[pctCons, pctDes], backgroundColor:['#1e88e5','#d32f2f'] }] },
    options:{ responsive:true }
  });

  // جدول خلاصه
  const summaryHtml = `<table><thead><tr><th>بعد</th><th>نمره</th><th>بیشترین نمره</th><th>درصد</th></tr></thead>
    <tbody>
      <tr><td>جمع سبک سازنده</td><td>${consTotal}</td><td>${consMax}</td><td>${Math.round((consTotal/consMax)*100)}%</td></tr>
      <tr><td>جمع سبک مخرب</td><td>${desTotal}</td><td>${desMax}</td><td>${Math.round((desTotal/desMax)*100)}%</td></tr>
    </tbody></table>`;
  document.getElementById('summaryTable').innerHTML = summaryHtml;

  // نمایش نتیجه
  document.getElementById('resultArea').classList.remove('hide');
  setTimeout(()=>{ document.getElementById('resultArea').scrollIntoView({behavior:'smooth'}); },100);

  // ذخیره گزارش برای دانلود
  window._lastReport = { meta:{name,gender,age,education}, consScores, desScores, consTotal, consMax, desTotal, desMax, pctCons, pctDes };

});

// دانلود PDF
document.getElementById('downloadPdfBtn').addEventListener('click', async function(){
  const el = document.getElementById('resultArea');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('p','mm','a4');
  const canvas = await html2canvas(el, { scale: 2, useCORS: true, logging:false });
  const img = canvas.toDataURL('image/png');
  const pageW = pdf.internal.pageSize.getWidth();
  const pageH = pdf.internal.pageSize.getHeight();
  const imgW = pageW - 20;
  const imgH = (canvas.height * imgW) / canvas.width;
  let pos = 10;
  if(imgH <= pageH - 20){
    pdf.addImage(img,'PNG',10,pos,imgW,imgH);
  } else {
    let heightLeft = imgH;
    let y = 0;
    while(heightLeft > 0){
      pdf.addImage(img,'PNG',10,pos - y,imgW,imgH);
      heightLeft -= (pageH - 20);
      if(heightLeft > 0) pdf.addPage();
      y += (pageH - 20);
    }
  }
  pdf.save('گزارش_پرسشنامه.pdf');
});

// دانلود Excel
document.getElementById('downloadXlsBtn').addEventListener('click', function(){
  const report = window._lastReport;
  if(!report){ alert('ابتدا فرم را ارسال کنید تا گزارش تولید شود.'); return; }

  const wb = XLSX.utils.book_new();
  const meta = [ ['فیلد','مقدار'], ['نام', report.meta.name], ['جنسیت', report.meta.gender], ['سن', report.meta.age], ['تحصیلات', report.meta.education], ['', ''] ];
  const consHeader = ['خرده‌مقیاس_سازنده','نمره','بیشترین'];
  const consRows = Object.entries(report.consScores).map(([k,v])=> [k, v.sum, v.max]);
  const desHeader = ['خرده‌مقیاس_مخرب','نمره','بیشترین'];
  const desRows = Object.entries(report.desScores).map(([k,v])=> [k, v.sum, v.max]);
  const ws1Data = meta.concat([consHeader], consRows, [['','']], [desHeader], desRows, [['','']], [['جمع سازنده', report.consTotal, report.consMax], ['جمع مخرب', report.desTotal, report.desMax]]);
  const ws1 = XLSX.utils.aoa_to_sheet(ws1Data);
  XLSX.utils.book_append_sheet(wb, ws1, 'گزارش');
  XLSX.writeFile(wb, 'گزارش_پرسشنامه.xlsx');
});

// پاک‌سازی فرم
document.getElementById('resetBtn').addEventListener('click', function(){
  if(confirm('می‌خواهید فرم پاک شود؟')){ document.getElementById('surveyForm').reset(); document.getElementById('resultArea').classList.add('hide'); window._lastReport = null; window.scrollTo({top:0,behavior:'smooth'}); }
});

// ===== اشتراک‌گذاری سریع =====
const pageLink = window.location.href;
function shareWhatsApp(){
  const txt = `پرسشنامه سبک فرزندپروری — نتایج فوری: ${pageLink}`;
  window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(txt)}`,'_blank');
}
function shareTelegram(){
  const txt = `پرسشنامه سبک فرزندپروری — ${pageLink}`;
  window.open(`https://t.me/share/url?url=${encodeURIComponent(pageLink)}&text=${encodeURIComponent('پیشنهاد می‌کنم این پرسشنامه را تکمیل کنید')}`,'_blank');
}
function shareInstagram(){
  alert('برای اشتراک در اینستاگرام: لینک را کپی کنید و در استوری یا دایرکت قرار دهید.');
}
function copyLink(){
  navigator.clipboard.writeText(pageLink).then(()=>{ document.getElementById('linkStatus').textContent = "لینک کپی شد!"; setTimeout(()=>{document.getElementById('linkStatus').textContent='';},2500); });
}

// ===== اشتراک‌گذاری نتایج متن (واتساپ) =====
function shareResultsWhatsApp(){
  const r = window._lastReport;
  if(!r){ alert('ابتدا نتیجه را تولید کنید.'); return; }
  const text = `نتایج پرسشنامه:\nجمع سبک سازنده: ${r.consTotal}/${r.consMax} (${r.pctCons}%)\nجمع سبک مخرب: ${r.desTotal}/${r.desMax} (${r.pctDes}%)\n${pageLink}`;
  window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`,'_blank');
}

// ===== محافظت ساده: جلوگیری از راست‌کلیک و کلیدهای توسعه‌دهنده =====
document.addEventListener('contextmenu', function(e){ e.preventDefault(); });
document.addEventListener('keydown', function(e){
  if(e.ctrlKey && (e.key === 'u' || e.key === 'U' || e.key === 'Shift' || e.key === 'I' || e.key === 'i')) e.preventDefault();
  if(e.key === 'F12') e.preventDefault();
});

</script>


<style>
/* رادیوباتون درشت، هم دسکتاپ هم موبایل */
input[type="radio"] {
  transform: scale(1.5); /* 1.5 برابر بزرگ‌تر */
  margin: 5px; /* فاصله کمی برای زیبایی */
  vertical-align: middle;
}
</style>


</body>
</html>
